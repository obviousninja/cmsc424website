<html>
	<head>
		<title>Nom.com</title>
		<script type="text/javascript">
			function generateOrders() {
				var entries = 
				<?php
				$servername = "localhost";
				$username = "jchen127";
		        $password = "KbZFqBcZCy29b3Lx";
		        $database = "myDB";
				// Create connection
				$conn = mysqli_connect($servername, $username, $password);

				// Check connection
				if (!$conn) {
				    die("Connection failed: " . mysqli_connect_error());
				}

				$cid = $_GET["customerid"];

				$sql = "SELECT * FROM $database.transaction t, $database.bill b, $database.customer c, $database.basket ba WHERE c.customerid = $cid AND c.customerid = t.customerid AND t.transactionid = b.transactionid AND ba.basketid = t.basketid";
				$result = mysqli_query($conn, $sql);

				$returnStr = "[";

				if ($result && mysqli_num_rows($result) > 0) {
				    // output data of each row
				    while($row = mysqli_fetch_assoc($result)) {
				        //echo "Customer name: " . $row["name"]. " - basketid: " . $row["basketid"] . " - productname: " . $row["productname"] . " - quantity: " . $row["productquantity"] . "<br>";
	   
				        $returnStr = $returnStr . "{" . "\"transactionid\": " . $row["transactionid"] . ",\n\"ordertime\": " . "\"" . $row["ordertime"] . "\"" . ",\n\"estimatetimeofarrival\":" . "\"" . $row["estimatetimeofarrival"] . "\"" . ",\n\"deliverydate\":" . "\"" . $row["deliverydate"] . "\"" . ",\n\"paymentflag\": " . $row["paymentflag"] . ",\n\"totalitemcost\":" . $row["totalitemcost"] . ",\n\"costwithtax\":" . $row["costwithtax"] . ",\n\"deliverycharge\":" . $row["deliverycharge"] . ",\n\"tip\":" . "\"" . $row["tip"] . "\"" . ",\n\"transactiontotal\":" . $row["transactiontotal"] . ",\n\"paidflag\":" . $row["paidflag"] . ",\n\"isstandingorder\":" . $row["isstandingorder"] . ",\n\"standingordertype\":" . "\"" . $row["standingordertype"] . "\"" . "}, \n";
				    }


				} else {
				    echo "0 results for finding orders!<br>";
				}

				mysqli_close($conn);

				$returnStr = $returnStr . "]";
				echo $returnStr;
				?>

				var listContainer = document.createElement("div"); 

				for (var i = 0; i < entries.length; i++) {
					var item = entries[i];

		            var listElement = document.createElement("div");
		            listElement.setAttribute("id", item["transactionid"]);
		            listElement.setAttribute("style", "border: 1px solid black; margin:15px 15px 0px 15px");

		            listContainer.appendChild(listElement);

		            for (var property in item) {
					    if (item.hasOwnProperty(property)) {
			                var listItem = document.createElement("p");
			                var needsTotal = false;

			                if (property === "ordertime") {
			                	listItem.innerHTML = "Time of Order: " + item[property];
			                } else if (property === "deliverydate") {
			                	if (item[property]) {
			                		listItem.innerHTML = "Delivery date: " + item[property];
			                	} else {
			                		listItem.innerHTML = "Estimated Time of Arrival: " + item["estimatetimeofarrival"];
			                	}
			                }else if (property === "paidflag") {
			                	if (item[property] == 1) {
			                		listItem.innerHTML = "PAID";
			                	} else {
			                		listItem.innerHTML = "NOT PAID";
			                	}
			                } else if (property === "paymentflag") {
			                	if (item[property] == 0) {
			                		listItem.innerHTML = "Method of payment: Credit Card";
			                	} else {
			                		listItem.innerHTML = "Method of payment: Check";
			                	}
			                } else if (property === "totalitemcost") {
			                	listItem.innerHTML = "Total Item Cost: $" + item[property].toFixed(2);
			                } else if (property === "costwithtax") {
			                	listItem.innerHTML = "Cost With Tax: $" + item[property].toFixed(2);
			                } else if (property === "deliverycharge") {
			                	listItem.innerHTML = "Delivery Charge: $" + item[property].toFixed(2);
			                } else if (property === "transactiontotal") {
			                	listItem.innerHTML = "Transaction Total: $" + item[property].toFixed(2);
			                } else if (property === "tip") {
			                	if (item[property]) {
			                		listItem.innerHTML = "Tip: $" + item[property].toFixed(2);
			                	} else {
			                		listItem.innerHTML = "Tip: $0.00";
			                	}
			                }

			                //<a onmouseover=\"document.getElementById('" + property + "').style.display='';\" onclick=\"document.getElementById('" + property + "').style.display='none';\" href=\"#\" id=\"showsubcategory\" >" + property + "</a>";

			                // add listItem to the listElement
			                listElement.appendChild(listItem);
			                /*if (needsTotal) {
				                var totalPriceItem = document.createElement("p");
				                totalPriceItem.innerHTML = "Total Cost: $" + (item["price"]*item["quantity"]).toFixed(2);
				                listElement.appendChild(totalPriceItem);
				            }*/
		            	}

		            }

		            var setStandingButton = document.createElement("input");
		            setStandingButton.setAttribute("type", "checkbox");
					setStandingButton.setAttribute("name", item["transactionid"] + "isstandingbox");
					if (item["isstandingorder"] == 1) {
						setStandingButton.setAttribute("checked", "true");
					}

					listElement.appendChild(setStandingButton);
					listElement.innerHTML += "Standing Order<br>";
					
				}
	            

	            // add it to the page
	            document.getElementsByTagName("body")[0].appendChild(listContainer);

			}
		</script>
	</head>
	<body>
		<?php 
			$cid = $_GET["customerid"];
			echo "Get CID: " . $cid . "<br>";
			$_SESSION["cid"] = $_GET["customerid"];
			$_SESSION["searchtext"] = "";

			include 'loggedinheader.php';
		?>

		<script type="text/javascript">
			generateOrders();
		</script>

		<form action="checkout.html" method="get">
			<input type="text" name="customerid" value="<?php echo $_SESSION["cid"] ?>">
			<input type="submit" value="Checkout">
		</form>
		

	</body>
</html>
